= Progressive Web Apps (PWA) - The Complete Guide
:icons: font
:source-highlighter: pygments
:toc: right
:toclevels: 4

NOTE: http-server in Android Studio emulator: http://10.0.2.2:8080


== Understanding the App Manifest

=== Useful Links

|===

| Add to home screen (A2HS) - Browser Support | https://caniuse.com/web-app-manifest

| MDN Article on the Web App Manifest (includes List of all Properties) | https://developer.mozilla.org/en-US/docs/Web/Manifest

| A detailed Web App Manifest Explanation by Google | https://web.dev/add-manifest/

| More about the "Web App Install Banner" (including Requirements) |  https://web.dev/customize-install/

|===

=== Understanding App Manifest Properties

```json
include::02-app-manifest/manifest.json[]
```

== The Service Workers

|===

| The App Install Banner: | https://web.dev/customize-install/
| DevTools | https://developer.chrome.com/docs/devtools/
|===

NOTE: Make sure you enabled "Developer Mode" on your Device! You do that by tapping your Android Build Number (in the Settings) 7 times. 

== Promise and Fetch


=== Useful Resources

==== Promises

[cols="1,3"]
|===
| *Introduction to Promises (MDN):* | https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise
| *Introduction to Promises (Google):* | https://developers.google.com/web/fundamentals/getting-started/primers/promises
|===

==== Fetch API

[cols="1,3"]
|===
| *An Overview on MDN:* | https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API
| *Detailed Usage Guide (MDN):* | https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
| *Detailed Usage Guide (and comparison with XMLHttpRequest):* | https://davidwalsh.name/fetch
| *Introduction to Fetch (Google):* | https://developers.google.com/web/updates/2015/03/introduction-to-fetch
|===

=== Assignment

==== Task 1

```js
  // Create a new Promise here and use setTimeout inside the function you pass to the constructor
  let promise = new Promise(
    function (resolve) {

      setTimeout(function () { // <- Store this INSIDE the Promise you created!
        // Resolve the following URL: https://swapi.co/api/people/1
        resolve('https://swapi.dev/api/people/1');
      }, 3000);

    }
  );

  promise.then(function (url) {
    // Handle the Promise "response" (=> the value you resolved) and returß a fetch()
    // call to the value (= URL) you resolved (use a GET request)
    return fetch(url, { mode: "no-cors" });
  }).then(function (response) {
    // Handle the response of the fetch() call and extract the JSON data, return that
    // and handle it in yet another then() block
    return response.json();
  }).then(function (data) {
    // Finally, output the "name" property of the data you got back (e.g. data.name) inside
    // the "output" element (see variables at top of the file)
    console.log('data:', data);
    output.innerHTML = data.name;
  });
```  
[WARNING]
====
sw.js:12 Cross-Origin Read Blocking (CORB) blocked cross-origin response https://swapi.dev/api/people/1 with MIME type application/json. See https://www.chromestatus.com/feature/5629709824032768 for more details.
====

==== Task 2

```js
  // Repeat the exercise with a PUT request you send to https://httpbin.org/put
  let promise = new Promise(
    function (resolve) {
      setTimeout(function () { // <- Store this INSIDE the Promise you created!        
        resolve('https://httpbin.org/put');
      }, 1000);
    }
  );

  // Make sure to set the appropriate headers (as shown in the lecture)
  // Send any data of your choice, make sure to access it correctly when outputting it
  // Example: If you send {person: {name: 'Max', age: 28}}, you access data.json.person.name
  // to output the name (assuming your parsed JSON is stored in "data")
  promise.then(function (url) {
    return fetch(url, {
      method: "PUT", 
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({
        name: "John"
      })
    });
  }).then(function (response) {
    return response.json();
  }).then(function (data) {
    console.log('data:', data);
    output.innerHTML = JSON.parse(data.data).name;
  });
```

==== Task 3

```js
  // Handle the error in catch()

  let promise = new Promise(
    function (resolve) {
      setTimeout(function () { 
        resolve('https://swapi.dev/api/people/1');
      }, 500);
    }
  );

  promise.then(function (url) {
    return fetch(url, { mode: "no-cors" });
  }).then(function (response) {
    return response.json();
  }).then(function (data) {
    console.log('-- data:', data);
    output.innerHTML = data.name;
  }).catch(function (err) {
    console.log('-- err:', err);
  });
```
==== Task 4

```js
  // Handle the error as a second argument to then()
  let promise = new Promise(
    function (resolve) {
      setTimeout(function () { 
        resolve('https://swapi.dev/api/people/1');
      }, 500);
    }
  );

  promise.then(function (url) {
    return fetch(url);
  },
  function (err) {
    console.log('-- err:', err);
  }).then(function (response) {
    return response.json();
  }).then(function (data) {
    console.log('-- data:', data);
    output.innerHTML = data.name;
  });
```

== Service Workers - Caching

=== Useful Resources

[cols="1,3"]
|===
| *About Cache Persistence and Storage Limits:* | https://jakearchibald.com/2014/offline-cookbook/#cache-persistence
| *Learn more about Service Workers:* |  https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API
|===

=== Static and Dynamic Caching

```js
include::05-sw-caching/sw-caching-01--updated-project/sw-caching-01--updated-project/public/sw.js[]
```

== Service Workers - Advanced Caching

=== Useful Resources

[cols="1,3"]
|===
| *Offline Cookbook:* | https://jakearchibald.com/2014/offline-cookbook/
| *Advanced Caching Guide:* | https://www.afasterweb.com/2017/01/31/upgrading-your-service-worker-cache/
| *Mozilla Strategy Cookbook:* | https://serviceworke.rs/strategy-cache-and-update_service-worker_doc.html
|===

=== Offering "Cache on Demand"

```js
function onSaveButtonClicked(event) {
  console.log('clicked');
  if ('caches' in window) {
    caches.open('user-requested')
    .then(function (cache) {
      cache.add('https://httpbin.org/get');
      cache.add('/src/images/sf-boat.jpg');
    });
  }
}
```

=== Providing an Offline Fallback Page

```js
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        if (response) {
          return response;
        } else {
          return fetch(event.request)
            .then(function(res) {
              return caches.open(CACHE_DYNAMIC_NAME)
                .then(function(cache) {
                  cache.put(event.request.url, res.clone());
                  return res;
                })
            })
            .catch(function(err) {
              return caches.open(CACHE_STATIC_NAME)
                .then(function (cache) {
                  return cache.match('/offline.html');  <1>
                });
            });
        }
      })
  );
});
```
<1> Return offline page stored in a static cache

=== Strategy: Cache with Network Fallback

This is what we implemented above.

=== Strategy: Network with Cache Fallback

```js
self.addEventListener('fetch', function(event) {
  event.respondWith(
    fetch(event.request)
      .then(function (res) {
        return caches.open(CACHE_DYNAMIC_NAME)
          .then(function(cache) {
            cache.put(event.request.url, res.clone());
            return res;
          })
      })
      .catch(function (err) {
        return caches.match(event.request);
      })
  );
});
```

=== Strategy: Cache then Network

.feed.js
```js
var url = 'https://httpbin.org/get';
var networkDataReceived = false;

fetch(url)
  .then(function(res) {
    return res.json();
  })
  .then(function(data) {
    networkDataReceived = true;
    console.log('From web', data);
    clearCards();
    createCard();
  });

if ('caches' in window) {
  caches.match(url)
    .then(function (response) {
      if (response) {
        return response.json();
      }
    })
    .then(function (data) {
      console.log('From cache', data);
      if (!networkDataReceived) {
        clearCards();
        createCard();
      }
    })
}
```

=== Cache then Network & Dynamic Caching

.sw.js
```js
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.open(CACHE_DYNAMIC_NAME)
      .then(function (cache) {
        return fetch(event.request)
          .then(function (res) {
            cache.put(event.request, res.clone());
            return res;
          })
      })
  );
});
```

=== Cache then Network with Offline Support

.sw.js
```js
self.addEventListener('fetch', function(event) {
  var url = 'https://httpbin.org/get';

  if (event.request.url.indexOf(url) > -1) {
    event.respondWith(
      caches.open(CACHE_DYNAMIC_NAME)
        .then(function (cache) {
          return fetch(event.request)
            .then(function (res) {
              cache.put(event.request, res.clone());
              return res;
            })
        })
    );
  } else {
    event.respondWith(
      caches.match(event.request)
        .then(function(response) {
          if (response) {
            return response;
          } else {
            return fetch(event.request)
              .then(function(res) {
                return caches.open(CACHE_DYNAMIC_NAME)
                  .then(function(cache) {
                    cache.put(event.request.url, res.clone());
                    return res;
                  })
              })
              .catch(function(err) {
                return caches.open(CACHE_STATIC_NAME)
                  .then(function (cache) {
                    return cache.match('/offline.html');
                  });
              });
          }
        })
      );
  }

});
```

== IndexedDB and Dynamic Data

.utility.js
```js
include::07-idb/idb-02--added-idb-package/public/src/js/utility.js[]
```

=== Useful Resources

[cols="1,3"]
|===
| *IDB on Github:* | https://github.com/jakearchibald/idb
| *IndexedDB explained on MDN:* | https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API
| *Alternative to IDB:* | http://dexie.org/
|===

== Creating a Responsive User Interface

=== Useful Resources

[cols="1,3"]
|===
| *Responsive Design Basics by Google:* | https://web.dev/learn/design/
| *Responsive Design Patterns (Google):* | https://web.dev/learn/design/ui-patterns/
| *Responsive Images (Google):* | https://web.dev/learn/design/responsive-images/
| *Using CSS Media Queries:* | https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries
| *Responsive Images (MDN):* | https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images
| *Responsive Images in CSS:* | https://css-tricks.com/responsive-images-css/
| *Using CSS Animations:* | http://learn.shayhowe.com/advanced-html-css/transitions-animations/
|===

== Background Sync

=== Useful Resources

.Firebase Functions
[cols="1,3"]
|===
| *Firebase Pricing:* | https://firebase.google.com/pricing
| *Firebase Console:* | https://console.firebase.google.com
| *Firebase Hosting:* | https://firebase.google.com/docs/hosting
| *Introducing Background Sync:* | https://developer.chrome.com/blog/background-sync/
| *A Basic Guide to Background Sync:* | https://ponyfoo.com/articles/backgroundsync
| *Cloud Functions for Firebase:* | https://firebase.google.com/docs/functions/
| *Create and Deploy Your First Cloud Functions:* | https://firebase.google.com/docs/functions/write-firebase-functions
|===

.Realtime Database
[cols="1,3"]
|===
| *Saving Data in Realtime Database:* | https://firebase.google.com/docs/database/admin/save-data
| `push():` | https://firebase.google.com/docs/reference/js/database#push
|===

=== feed.js

```js
var MY_FIREBASE_ID = '...'; <7>
var MY_TEST_IMAGE_URL = '...'; <8>

function sendData() { <2>
  fetch(MY_FIREBASE_ID + '.firebasedatabase.app/posts.json', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      id: new Date().toISOString(),
      title: titleInput.value,
      location: locationInput.value,
      image: MY_TEST_IMAGE_URL
    })
  })
    .then(function(res) {
      console.log('Sent data', res);
      updateUI();
    });
}

form.addEventListener('submit', function(event) { <6>
  event.preventDefault();

  if (titleInput.value.trim() === '' || locationInput.value.trim() === '') {
    alert('Please enter valid data!');
    return;
  }

  closeCreatePostModal();

  if ('serviceWorker' in navigator && 'SyncManager' in window) {
    navigator.serviceWorker.ready <3>
      .then(function(sw) {
        var post = {
          id: new Date().toISOString(),
          title: titleInput.value,
          location: locationInput.value
        };
        writeData('sync-posts', post)
          .then(function () {
            return sw.sync.register('sync-new-posts')  <4>
          })
          .then(function () {
            var snackbarContainer = document.querySelector("#confirmation-toast"); <5>
            var data = {message: "Your Post was saved for syncing!"};
            snackbarContainer.MaterialSnackbar.showSnackbar(data);
          }).catch(function (err) {
            console.log(err);
          });
      });
  } else {
    sendData(); <1>
  }
});
```

<1> отправляем данные если браузер не поддерживает background sync
<2> отправка данных
<3> background sync
<4> регистрируем background sync event tag
<5> показать toast что в оффлайне мы сохранили сообщение в idb
<6> background sync происходит по сабмиту формы
<7> id of my firebase
<8> url of my test image

=== sw.js

```js
var MY_FIREBASE_ID = '...'; <1>
var MY_TEST_IMAGE_URL = '...'; <3>

self.addEventListener('sync', function(event) {
  console.log('[Service Worker] Background syncing', event);
  if (event.tag === 'sync-new-posts') {
    console.log('[Service Worker] Syncing new Post');
    event.waitUntil(
      readAllData('sync-posts')
        .then(function(data) {
          for (var dt of data) {
            fetch(MY_FIREBASE_ID + '.firebasedatabase.app/posts.json', { <4>
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              body: JSON.stringify({
                id: dt.id,
                title: dt.title,
                location: dt.location,
                image: MY_TEST_IMAGE_URL
              })
            })
              .then(function(res) {
                console.log('Sent data', res);
                if (res.ok) {
                  deleteItemFromData('sync-posts', dt.id); <2>
                }
              })
              .catch(function (err) {
                console.log('Error while sending data', err);
              });
          }
        })
    );
  }

});
```

<1> id of my firebase
<2> bug here - async call cannot work with loop variable
<3> url of my test image
<4> когда мы заменили этот url на функцию firebase `storePostData` возникла проблема CORS

=== functions

.functions/index.js
```js
const functions = require("firebase-functions");
var admin = require('firebase-admin');
var cors = require('cors')({ origin: true });

var serviceAccount = require("./pwagram-fb-key.json");
var MY_DB_URL = '...'; <1>

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: MY_DB_URL
});

exports.storePostData = functions.https.onRequest((request, response) => {
    cors(request, response, function () {
        var reqBody = request.body;
        functions.logger.info('-- reqBody:', reqBody, '.'); <2>
        var newPost = {
            id: reqBody.id,
            title: reqBody.title,
            location: reqBody.location,
            image: reqBody.image
        };
        functions.logger.info('-- newPost:', newPost, '.');

        admin.database().ref('posts').push(newPost)
            .then(function () {
                response.status(201).json({ message: 'Data stored', id: request.body.id });
            })
            .catch(function (err) {
                response.status(500).json({ error: err });
            });
    });    
    //   response.send("Hello from Firebase!");
});
```

<1> url of my realtime database
<2> последний элемент лога пусть будет просто строкой, иначе он может пропасть из лога :-(

////
<1> интересно, почему эта библиотека не добавляет заголовок `Access-Control-Allow-Origin` ?

[WARNING]
.Error in Chrome
====
Access to fetch at `https://<MY_FIREBASE_APP>.web.app/storePostData` from origin `http://127.0.0.1:8080` has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No `Access-Control-Allow-Origin` header is present on the requested resource. If an opaque response serves your needs, set the request's mode to `no-cors` to fetch the resource with CORS disabled.
====
////

== Web Push Notifications

=== Useful Resources

[cols="1,3"]
|===
| *More about Web Push by Google:* | https://web.dev/notifications/
| *More about VAPID:* | https://blog.mozilla.org/services/2016/04/04/using-vapid-with-webpush/
| *More about VAPID by Google:* | https://developer.chrome.com/blog/web-push-interop-wins/
| *The web-push npm Package:* | https://github.com/web-push-libs/web-push
| *More about showNotification (display Notifications from Service Workers):* | https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification
| *The Notification API:* | https://developer.mozilla.org/en/docs/Web/API/notification
| *The Push API:* | https://developer.mozilla.org/en/docs/Web/API/Push_API
|===

=== app.js : askForNotificationPermission

.public/src/js/app.js
```js
function displayConfirmNotification() { <5>
  var options = {
    body: "You successfully subscribed to our Notification service!"
  };
  new Notification('Successfully subscribed!', options); 
}

function askForNotificationPermission() { 
  Notification.requestPermission(function(result) { <4>
    console.log('User Choice', result);
    if (result !== 'granted') {
      console.log('No notification permission granted!');
    } else {
      //displayConfirmNotification(); <6>
      configurePushSub() <7>
    }
  });
}

if ('Notification' in window) { <1>
  for (var i = 0; i < enableNotificationsButtons.length; i++) {
    enableNotificationsButtons[i].style.display = 'inline-block'; <2>
    enableNotificationsButtons[i].addEventListener('click', askForNotificationPermission); <3>
  }
}
```

<1> Can I use Web Push Notifications?
<2> Сделать видимой кнопку `Enable Notifications`
<3> Повесить обработчик на кнопку
<4> Запросить разрешение на отправку пуш-нотификаций
<5> Показать нотификацию, первая версия, без параметров
<6> Изначально мы просто показывали нотификацию
<7> А теперь подписываемся на нотификацию от сервера

=== app.js : displayConfirmNotification

.public/src/js/app.js
```js
function displayConfirmNotification() { <4>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.ready
      .then(function(swreg) {
        var options = {
          body: "You successfully subscribed to our Notification service!",
          icon: "/src/images/icons/app-icon-96x96.png",
          image: "/src/images/sf-boat.jpg",
          dir: "ltr",
          lang: "en-US", // BCP 47
          vibrate: [100, 50, 200],
          badge: "/src/images/icons/app-icon-96x96.png",
          tag: "confirm-notification", <2>
          renotify: true, <3>
          actions: [
            { action: "confirm", title: "Okay", icon: "/src/images/icons/app-icon-96x96.png" },
            { action: "cancel", title: "Cancel", icon: "/src/images/icons/app-icon-96x96.png" }
          ]
        };
        swreg.showNotification('Successfully subscribed (from SW)!', options); <1>
      });
  }
}
```

<1> Display notification from service worker
<2> Notifications can be stacked on some OSes
<3> Additional notifications should also produce a sound
<4> Показать нотификацию, вторая версия, с параметрами

=== sw.js : notificationclick

.public/sw.js
```js
self.addEventListener('notificationclick', function(event) { <1>
  var notification = event.notification;
  var action = event.action;

  console.log(notification);

  if (action === 'confirm') {
    console.log('Confirm was chosen');
  } else {
    console.log(action);    
  }
  notification.close(); <2>
});
```

<1> Обработчик кнопки на нотификации. В этом случае возникает событие `notificationclick`
<2> Закрываем нотификацию

=== sw.js : notificationclose

.public/sw.js
```js
self.addEventListener('notificationclose', function(event) { <1>
  console.log('Notification was closed', event);
});
```

<1> событие `notificationclose` возникает при закрытии нотификации

=== app.js : configurePushSub

.public/src/js/app.js
```js
function configurePushSub() { <1>
  if (!('serviceWorker' in navigator)) {
    return;
  }

  var reg;
  navigator.serviceWorker.ready
    .then(function (swreg) {
      reg = swreg;
      return swreg.pushManager.getSubscription(); <2>
    })
    .then(function (sub) {
      if (sub === null) {
        // Create a new subscription
        var vapidPublicKey = "..."; <3>
        var convertedVapidPublicKey = urlBase64ToUint8Array(vapidPublicKey); <4>
        return reg.pushManager.subscribe({ <5>
          userVisibleOnly: true,
          applicationServerKey: convertedVapidPublicKey
        });
      } else {
        // We have a subscription
      }

    })
    .then(function (newSub) { <6>
      return fetch(MY_FIREBASE_ID + ".firebasedatabase.app/subscriptions.json", { <8>
        method: 'POST',
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        body: JSON.stringify(newSub)
      });
    })
    .then(function (res) { <7>
      if (res.ok) {
        displayConfirmNotification();
      }
    })
    .catch(function(err) {
      console.log(err);
    });
}
```

<1> Подписываемся на нотификацию от сервера
<2> Получаем подписку из `pushManager`
<3> В папке `functions` мы выполнили `npm install web-push` +
    а затем `npm run web-push generate-vapid-keys` +
    В итоге получили `Public Key` и `Private Key`
<4> Конвертировать ключ в `Uint8Array`
<5> Получить подписку у браузера
<6> Сохранить подписку в базе
<7> Показать нотификацию, если подписка успешно сохранена
<8> id of my firebase

=== utility.js : urlBase64ToUint8Array

.public/src/js/utility.js    
```js
function urlBase64ToUint8Array(base64String) { <1>
  var padding = '='.repeat((4 - base64String.length % 4) % 4);
  var base64 = (base64String + padding)
    .replace(/\-/g, '+')
    .replace(/_/g, '/');

  var rawData = window.atob(base64);
  var outputArray = new Uint8Array(rawData.length);

  for (var i = 0; i < rawData.length; ++i) {
    outputArray[i] = rawData.charCodeAt(i);
  }
  return outputArray;
}
```

<1> Конвертация строки `Base64` в `Uint8Array`

=== sw.js : push

.public/sw.js
```js
self.addEventListener('push', function(event) { <1>
  console.log('Push Notification received', event);

  var data = {title: "New!", content:"Something new happened!"}; <2>
  if (event.data) {
    data = JSON.parse(event.data.text()); <3>
  }

  var options = {
    body: data.content,
    icon: '/src/images/icons/app-icon-96x96.png',
    badge: '/src/images/icons/app-icon-96x96.png'
  };

  event.waitUntil(
    self.registration.showNotification(data.title, options) <4>
  );
});
```

<1> Получаем пуш-нотификацию
<2> Дефолтное сообщение
<3> Сообщение с сервера
<4> Показать нотификацию на устройстве

=== sw.js : notificationclick

.public/sw.js
```js
self.addEventListener('notificationclick', function(event) {
  var notification = event.notification;
  var action = event.action;

  console.log(notification);

  if (action === 'confirm') {
    console.log('Confirm was chosen');
    notification.close();
  } else {
    console.log(action);
    event.waitUntil(
      clients.matchAll() <3>
        .then(function (clis) {
          var client = clis.find(function (c) {
            return c.visibilityState === 'visible'
          });

          if (client !== undefined) {
            client.navigate('http://localhost:8080'); <1>
            client.focus();
          } else {
            clients.openWindow('http://localhost:8080'); <2>
          }
          notification.close();
        })
    );
  }
});
```

<1> Клик по пуш-нотификации может перейти на указанную страницу...
<2> ...либо открыть новое окно браузера 
<3> Сервис-воркеру доступен список связанных с ним табов в браузере, и мы можем выбрать текущий активный

=== sw.js : push

.public/sw.js
```js
self.addEventListener('notificationclick', function(event) {
  var notification = event.notification;
  var action = event.action;

  console.log(notification);

  if (action === 'confirm') {
    console.log('Confirm was chosen');
    notification.close();
  } else {
    console.log(action);
    event.waitUntil(
      clients.matchAll()
        .then(function (clis) {
          var client = clis.find(function (c) {
            return c.visibilityState === 'visible'
          });

          if (client !== undefined) {
            client.navigate(notification.data.url); <2>
            client.focus();
          } else {
            clients.openWindow(notification.data.url);
          }
          notification.close();
        })
    );
  }
});

self.addEventListener('push', function(event) {
  console.log('Push Notification received', event);

  var data = {title: "New!", content:"Something new happened!", openUrl: "/"};
  if (event.data) {
    data = JSON.parse(event.data.text());
  }

  var options = {
    body: data.content,
    icon: '/src/images/icons/app-icon-96x96.png',
    badge: '/src/images/icons/app-icon-96x96.png',
    data: {
      url: data.openUrl <1>
    }
  };

  event.waitUntil(
    self.registration.showNotification(data.title, options)
  );
});
```

<1> Как вариант, мы можем передать имя страницы, на которую нужно перейти по пуш-нотификации...
<2> ...и перейти на указанную страницу по клику на нотификации
