<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Working with Refs &amp; Portals</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Working with Refs &amp; Portals</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_131_module_introduction_starting_project">131. Module Introduction &amp; Starting Project</a></li>
<li><a href="#_132_repetition_managing_user_input_with_state_two_way_binding">132. Repetition - Managing User Input with State (Two-Way-Binding)</a></li>
<li><a href="#_134_introducing_refs_connecting_accessing_html_elements_via_refs">134. Introducing Refs - Connecting &amp; Accessing HTML Elements via Refs</a></li>
<li><a href="#_135_manipulating_the_dom_via_refs">135. Manipulating the DOM via Refs</a></li>
<li><a href="#_136_refs_vs_state_values">136. Refs vs State Values</a></li>
<li><a href="#_137_adding_challenges_to_the_demo_project">137. Adding Challenges to the Demo Project</a></li>
<li><a href="#_138_setting_timers_managing_state">138. Setting Timers &amp; Managing State</a></li>
<li><a href="#_139_using_refs_for_more_than_dom_element_connections">139. Using Refs for More Than DOM Element Connections</a></li>
<li><a href="#_140_adding_a_modal_component">140. Adding a Modal Component</a></li>
<li><a href="#_141_forwarding_refs_to_custom_components">141. Forwarding Refs to Custom Components</a></li>
<li><a href="#_142_exposing_component_apis_via_the_useimperativehandle_hook">142. Exposing Component APIs via the useImperativeHandle Hook</a></li>
<li><a href="#_143_more_examples_when_to_use_refs_state">143. More Examples - When To Use Refs &amp; State</a></li>
<li><a href="#_144_sharing_state_across_components">144. Sharing State Across Components</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="udemy_react.html">&lt;Contents&gt;</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_131_module_introduction_starting_project">131. Module Introduction &amp; Starting Project</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Focus:</strong> React Refs and Portals—optional but powerful tools for specific
problems.</p>
</li>
<li>
<p><strong>Refs:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Provide direct access to DOM elements.</p>
</li>
<li>
<p>Store mutable values that shouldn’t trigger re-renders (not state).</p>
</li>
<li>
<p>Let components expose an API (e.g., callable functions) to other
components.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Portals:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Render elements in a different place in the DOM than where they
appear in JSX (e.g., <code>modals/overlays</code>).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Demo project:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Build a timer challenge game using Refs, Portals, components, and
state.</p>
</li>
<li>
<p>Starter projects available (local and CodeSandbox).</p>
</li>
<li>
<p>Initial setup includes a basic App and Player component; the input’s
“Set Name” button doesn’t work yet—fixing it will be the first Refs
example.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<a href="https://github.com/academind/react-complete-guide-course-resources/tree/main/code/08%20Refs%20Portals" target="_blank">
code/08 Refs Portals</a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_132_repetition_managing_user_input_with_state_two_way_binding">132. Repetition - Managing User Input with State (Two-Way-Binding)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The text walks through implementing a React “player” component that
replaces “unknown entity” with a user-entered name <strong>using <code>useState</code> (no
refs)</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Import <code>useState</code> and create state <code>enteredPlayerName</code> (initially
<code>''</code>).</p>
</li>
<li>
<p>Add <code>handleChange</code> and wire it to the input’s <code>onChange</code> to store
<code>event.target.value</code> in state.</p>
</li>
<li>
<p>Make the input a controlled component by binding
<code>value={enteredPlayerName}</code>.</p>
</li>
<li>
<p>Add a second state, e.g. <code>submitted</code> (initially <code>false</code>), plus
<code>handleClick</code> on the button to set <code>submitted(true)</code>.</p>
</li>
<li>
<p>Conditionally render after “Welcome” via a ternary:</p>
<div class="ulist">
<ul>
<li>
<p>if <code>submitted</code> → show <code>enteredPlayerName</code></p>
</li>
<li>
<p>else → show <code>"unknown entity"</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Notes a behavior issue: after submitting, the displayed name updates
on every keystroke because it uses <code>enteredPlayerName</code>. To avoid that,
you can reset <code>submitted</code> to <code>false</code> in <code>handleChange</code>, but that causes
the UI to jump back to “unknown entity” while typing.</p>
</li>
<li>
<p><strong>Conclusion:</strong> this is a case where the state-based approach becomes
verbose/awkward for simply reading the input value on button click,
motivating the use of <strong>refs</strong> to simplify the component.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<a href="https://github.com/academind/react-complete-guide-course-resources/blob/main/code/08%20Refs%20Portals/02-user-input-with-state/src/components/Player.jsx" target="_blank">
02-user-input-with-state/src/components/Player.jsx</a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_134_introducing_refs_connecting_accessing_html_elements_via_refs">134. Introducing Refs - Connecting &amp; Accessing HTML Elements via Refs</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>What a ref is</p>
<div class="ulist">
<ul>
<li>
<p>A <code>ref</code> in React is a React-managed value object (created with <code>useRef</code>)
that holds a <code>.current</code> property.</p>
</li>
<li>
<p>You typically use refs to get direct access to a DOM element (or to
hold a mutable value that persists across renders).</p>
</li>
</ul>
</div>
</li>
<li>
<p>How to create and connect a ref</p>
<div class="ulist">
<ul>
<li>
<p>Create: <code>const inputRef = useRef()</code></p>
</li>
<li>
<p>Connect to JSX:</p>
</li>
<li>
<p>The connected DOM element is available as <code>inputRef.current</code> after
mount.</p>
</li>
</ul>
</div>
</li>
<li>
<p>How this simplifies the component</p>
<div class="ulist">
<ul>
<li>
<p>Instead of updating component state on every keystroke with an
<code>onChange</code> handler (controlled input), attach a ref to the input and read
<code>inputRef.current.value</code> only when you need it (for example on button
click).</p>
</li>
<li>
<p>This removes the need for the per-keystroke handler, the input value
prop, and intermediate submitted state — fewer props and less code.</p>
</li>
<li>
<p>Example flow:</p>
<div class="ulist">
<ul>
<li>
<p><code>useRef</code> to create <code>inputRef</code></p>
</li>
<li>
<p>On button click: <code>const value = inputRef.current.value;</code>
setEnteredPlayerName(value)</p>
</li>
<li>
<p>Render <code>enteredPlayerName</code> (with a fallback like 'Unknown' if empty)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Small note about fallback operators</p>
<div class="ulist">
<ul>
<li>
<p>The speaker mentioned "two question marks" (<code>??</code>) as a shortcut for
fallback. <code>??</code> is the nullish coalescing operator (falls back only on
null/undefined). If you want to treat empty string as fallback, use <code>||</code>
instead.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Short example (conceptual)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>const inputRef = useRef()</code></p>
</li>
<li>
<p><code>&lt;input ref={inputRef} /&gt;</code></p>
</li>
<li>
<p><code>function handleClick() { setEnteredPlayerName(inputRef.current.value) }</code></p>
</li>
<li>
<p>Remove <code>onChange</code>, <code>value</code> prop, and any submitted state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Result: you update state only when needed (on click), read the real DOM
input value via ref, and keep the component leaner.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_135_manipulating_the_dom_via_refs">135. Manipulating the DOM via Refs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The lecture explains that refs can be used to clear an input (e.g., setting playerName.current.value = '') which is concise and works. However, directly setting DOM values is imperative and conflicts with React’s declarative philosophy — reading a ref is fine, but mutating DOM via refs is a departure from letting React manage state and UI. For simple, isolated cases (like clearing an uncontrolled input) using a ref can be acceptable and save code, but you should avoid relying on refs to read/manipulate many values; prefer state and declarative patterns when the input is part of app state.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_136_refs_vs_state_values">136. Refs vs State Values</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Refs can hold a reference to a DOM element (e.g., an input) and let you read its current value directly.</p>
</li>
<li>
<p>On the first render the <code>ref</code> connection (<code>ref.current</code>) is not yet established, so <code>ref.current</code> can be undefined. Accessing <code>ref.current.value</code> then causes an error unless you check <code>ref.current</code> is truthy first.</p>
</li>
<li>
<p>Crucially, changing a <code>ref</code> does NOT cause the component function to re-run (no re-render). That’s why replacing state with a ref-only approach meant the UI didn’t update when the input value changed.</p>
</li>
<li>
<p>State updates (via <code>setState</code>) do cause the component to re-execute and re-render, so state should be used for values that must be reflected in the UI.</p>
</li>
<li>
<p>Use refs for behind-the-scenes values or direct DOM access where re-rendering is not required. Use state for any values that need to update the UI.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both concepts are important and serve different purposes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_137_adding_challenges_to_the_demo_project">137. Adding Challenges to the Demo Project</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Add a new TimerChallenge component (default export) that returns a
section with class "challenge" (uses the project&#8217;s CSS).</p>
</li>
<li>
<p>Structure inside the section:</p>
<div class="ulist">
<ul>
<li>
<p>h2 that displays a title prop.</p>
</li>
<li>
<p>p.challenge-time that displays the target time (e.g., "1 second" or
"5 seconds") with conditional pluralization (add "s" only if targetTime
&gt; 1).</p>
</li>
<li>
<p>p with a button that will toggle the timer text between "start
challenge" and "stop challenge" (controlled by state later).</p>
</li>
<li>
<p>p whose class is "active" only when the timer is running; its text
should read "time is running" when running or "timer inactive" when not.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In App, import the component and render four instances inside the
div#challenges:</p>
<div class="ulist">
<ul>
<li>
<p>"easy" — targetTime 1</p>
</li>
<li>
<p>"not easy" — targetTime 5</p>
</li>
<li>
<p>"getting tough" — targetTime 10</p>
</li>
<li>
<p>"pros only" — targetTime 15</p>
</li>
</ul>
</div>
</li>
<li>
<p>Note: Buttons are currently non-functional; state (and later refs)
will be added to control starting/stopping and the running status.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_138_setting_timers_managing_state">138. Setting Timers &amp; Managing State</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Goal: start a countdown when the "Start Challenge" button is pressed
and detect when it expires.</p>
</li>
<li>
<p>Implementation:</p>
<div class="ulist">
<ul>
<li>
<p>Create <code>handleStart</code> that uses JavaScript <code>setTimeout</code> (not
React-specific) with <code>delay = targetTime * 1000</code> (convert seconds → ms).</p>
</li>
<li>
<p>Use <code>useState</code> for two pieces of state:</p>
<div class="ulist">
<ul>
<li>
<p><code>timerExpired</code> (initial false) — set to true inside the timeout
callback; when true show a "You lost" paragraph.</p>
</li>
<li>
<p><code>timerStarted</code> (initial false) — set to true immediately when starting
the timer; used to change UI (button text from "Start Challenge" →
"Stop", add an active class, and show "Time is running" vs "Timer
inactive").</p>
</li>
</ul>
</div>
</li>
<li>
<p>Connect <code>handleStart</code> to the button <code>onClick</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Next step: implement <code>handleStop</code> to clear the timer. To access the
timeout ID from <code>handleStop</code>, store it in a ref (<code>useRef</code>) so you can call
<code>clearTimeout</code> on it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_139_using_refs_for_more_than_dom_element_connections">139. Using Refs for More Than DOM Element Connections</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To stop a timer you call <code>clearTimeout</code> with the ID returned by
<code>setTimeout</code> — so you must keep a reference to that ID.</p>
</li>
<li>
<p>Storing the timer ID in a plain variable inside the component fails
because the component function re-executes on state changes and that
variable is recreated. The <code>handleStop</code> will see a different/unstored
value.</p>
</li>
<li>
<p>Moving the variable outside the component makes it persist across
renders, but then it’s shared by all component instances. Starting one
instance overwrites the ID of another, so stopping one can fail to clear
the other’s timer.</p>
</li>
<li>
<p>The correct solution is to use a ref (<code>useRef</code>):</p>
<div class="ulist">
<ul>
<li>
<p>Create a ref in the component: <code>const timerRef = useRef(null)</code>.</p>
</li>
<li>
<p>Save the ID: <code>timerRef.current = setTimeout(&#8230;&#8203;)</code>.</p>
</li>
<li>
<p>Clear it: <code>clearTimeout(timerRef.current)</code>.</p>
</li>
<li>
<p>A ref is instance-specific (not shared across component instances),
persists across re-renders, and changing <code>.current</code> does not trigger a
rerender.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use refs for values that must persist across renders but do not
directly drive UI updates (timers, mutable handles, etc.).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_140_adding_a_modal_component">140. Adding a Modal Component</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Added a new <code>ResultModal</code> component to show a pop-up when the timer ends (won or lost) and later to show the score (based on how close to expiry the timer was).</p>
</li>
<li>
<p>ResultModal returns the native HTML <code>&lt;dialog&gt;</code> element with an <code>h2</code> for the result, a paragraph showing the target time (and later the seconds left), a form with <code>method="dialog"</code> and a close button so the dialog can be closed without extra JS, and a <code>className</code> for styling.</p>
</li>
<li>
<p><code>TimerChallenge</code> will import and render <code>ResultModal</code> conditionally (for example when the timer expired). The component was placed alongside the existing section by wrapping the JSX in a fragment, and the old inline conditional paragraph was removed.</p>
</li>
<li>
<p>Important detail: simply adding the <code>open</code> attribute to <code>&lt;dialog&gt;</code> makes it visible but does not show the built-in backdrop. To get the backdrop you must open the dialog programmatically (e.g., using the <code>dialog.showModal()</code> API), which requires accessing the dialog element via a ref from the parent component (<code>TimerChallenge</code>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_141_forwarding_refs_to_custom_components">141. Forwarding Refs to Custom Components</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<a href="https://github.com/academind/react-complete-guide-course-resources/blob/main/code/08%20Refs%20Portals/08-forwarding-refs/src/components/ResultModal.jsx" target="_blank">
08 Refs Portals/08-forwarding-refs/src/components/ResultModal.jsx</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Goal: access the native element inside <code>ResultModal</code> from the
<code>TimerChallenge</code> component using a ref so <code>TimerChallenge</code> can call
<code>dialog.showModal()</code> when the timer expires.</p>
</li>
<li>
<p>Modern React (≥19) approach:</p>
<div class="ulist">
<ul>
<li>
<p>Create a ref in <code>TimerChallenge</code> (e.g., <code>dialog</code>).</p>
</li>
<li>
<p>Pass that ref as a prop to (or any prop name you choose).</p>
</li>
<li>
<p>In <code>ResultModal</code> assign that received ref to the dialog element’s ref
attribute so <code>dialog.current</code> points to the element.</p>
</li>
<li>
<p>Call <code>dialog.current.showModal()</code> from <code>TimerChallenge</code> when needed. The
dialog element’s <code>showModal()</code> is a standard browser API.</p>
</li>
<li>
<p>Keep <code>ResultModal</code> rendered (it can be invisible) so the dialog element
exists.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Older React (&lt;19) issue:</p>
<div class="ulist">
<ul>
<li>
<p>Older React versions do not allow accepting a ref as a normal prop
and will error if you try.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Compatible solution for older React:</p>
<div class="ulist">
<ul>
<li>
<p>Wrap the <code>ResultModal</code> function with <code>React.forwardRef</code>.</p>
</li>
<li>
<p><code>forwardRef</code> returns an adjusted component that receives props as the
first parameter and the forwarded ref as a second parameter.</p>
</li>
<li>
<p>Use that second parameter to attach the ref to the dialog element and
export the wrapped component.</p>
</li>
<li>
<p>This <code>forwardRef</code> pattern is optional in modern React but required when
working with older versions.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Practical note: both approaches work; <code>forwardRef</code> is commonly seen in
codebases and necessary for compatibility with older React.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_142_exposing_component_apis_via_the_useimperativehandle_hook">142. Exposing Component APIs via the useImperativeHandle Hook</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<a href="https://github.com/academind/react-complete-guide-course-resources/blob/main/code/08%20Refs%20Portals/09-exposing-cmp-apis-useimperative-handle/src/components/ResultModal.jsx" target="_blank">
08 Refs Portals/09-exposing-cmp-apis-useimperative-handle/src/components/ResultModal.jsx</a>
</div>
</div>
<div class="paragraph">
<p>Summary — exposing a stable, callable API from a component with
useImperativeHandle</p>
</div>
<div class="paragraph">
<p>Problem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calling DOM methods (e.g., dialog.showModal()) from a parent via a ref
couples the parent to the child’s internal markup. If the child changes
(dialog → div), the parent breaks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Solution</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Let the child expose a stable function-based API via
useImperativeHandle (optionally combined with forwardRef). The parent
calls that public method (e.g., open()) instead of calling internal DOM
methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How it works (implementation outline)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the child (ResultModal):</p>
<div class="ulist">
<ul>
<li>
<p>Create an internal ref for the dialog element: const dialog =
useRef().</p>
</li>
<li>
<p>Wrap the component with forwardRef (or accept a ref prop in React
19+).</p>
</li>
<li>
<p>Call <code>useImperativeHandle(ref, () &#8658; ({ open: () &#8658; dialog.current.showModal() }))</code>.</p>
</li>
<li>
<p>Attach dialog to the dialog element: &#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the parent:</p>
<div class="ulist">
<ul>
<li>
<p>Hold a ref and pass it to .</p>
</li>
<li>
<p>Call dialogRef.current.open() — this calls the child’s exposed open
method.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notes / benefits</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decouples parent from child implementation details; the child can
change internals while keeping the same exposed API.</p>
</li>
<li>
<p>Prefer props/state for normal interaction; useImperativeHandle for
imperative APIs (like showing a modal).</p>
</li>
<li>
<p>forwardRef is needed in older React versions; with React 19+ you can
accept the ref as a prop instead.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_143_more_examples_when_to_use_refs_state">143. More Examples - When To Use Refs &amp; State</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Replace <code>setTimeout</code> with <code>setInterval</code> so you can track remaining time continuously (example uses 10 ms intervals; choose a sensible value for performance).</p>
</li>
<li>
<p>Manage a single piece of state: <code>timeRemaining</code> (in milliseconds). Initialize it to <code>targetTime * 1000</code>.</p>
</li>
<li>
<p>In the interval callback update state with the functional form: <code>setTimeRemaining(prev &#8658; prev - 10)</code>.</p>
</li>
<li>
<p>Keep the interval id in a ref (not state or a plain variable) so you can clear it later with clearInterval(ref.current).</p>
</li>
<li>
<p>Derive whether the timer is active from <code>timeRemaining</code> (e.g., active when <code>timeRemaining &gt; 0 &amp;&amp; timeRemaining &lt; targetTime*1000</code>) and use that derived value to conditionally render/buttons and behavior.</p>
</li>
<li>
<p>Detect expiration in the component body (if <code>timeRemaining &#8656; 0</code>): clear the interval, reset timeRemaining to the initial value, and open the result modal. Note the caution about calling state setters inside the component body — it’s safe here because the if condition won’t be true after updating state.</p>
</li>
<li>
<p>Also clear the interval and open the same modal in <code>handleStop</code> (manual stop). The modal open call is the same in both cases; the message can differ (you won if you stopped it manually, you lost if it expired).</p>
</li>
<li>
<p>Next necessary step: pass the correct information (win/loss and a score computed from remaining time) into the modal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Key code ideas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">intervalIdRef.current = setInterval(...);
setTimeRemaining(prev =&gt; prev - 10);
clearInterval(intervalIdRef.current);
dialogRef.current.open();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_144_sharing_state_across_components">144. Sharing State Across Components</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Replace the old result prop with a <code>remainingTime</code> prop on the result
modal and pass the timer&#8217;s <code>timeRemaining</code> state to it.</p>
</li>
<li>
<p>In <code>ResultModal</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Destructure <code>remainingTime</code>.</p>
</li>
<li>
<p>Compute a <code>userLost</code> boolean: <code>userLost = remainingTime &#8656; 0</code>.</p>
</li>
<li>
<p>Conditionally show an "You lost" message when <code>userLost</code> is true.</p>
</li>
<li>
<p>Format <code>remainingTime</code> (stored in milliseconds) to seconds by dividing
by 1000 and using <code>toFixed(2)</code> for a two-decimal display, and show that
value.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Remove the obsolete result prop.</p>
</li>
<li>
<p>Fix a bug: <code>TimerChallenge</code> was resetting <code>timeRemaining</code> back to the
initial value exactly when the timer expired, so the modal saw a
positive time and couldn&#8217;t detect the loss. Solution:</p>
<div class="ulist">
<ul>
<li>
<p>Move the reset logic into a separate <code>handleReset</code> function.</p>
</li>
<li>
<p>Pass <code>handleReset</code> into <code>ResultModal</code> as an <code>onReset</code> prop.</p>
</li>
<li>
<p>In <code>ResultModal</code>, destructure <code>onReset</code> and attach it to the form&#8217;s
<code>onSubmit</code> so the timer is reset when the modal is closed/submitted.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Outcome: when the timer expires the modal now correctly shows "You
lost" and 0.00 seconds, and closing the modal triggers the reset so the
timer can be restarted.</p>
</li>
<li>
<p>Next step: show a success message and calculate/display a score when
the timer is stopped in time.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2026-02-04 10:30:24 +0200
</div>
</div>
</body>
</html>