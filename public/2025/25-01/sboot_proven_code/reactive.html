<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Chapter 8: Spring Reactive and Spring Cloud Stream</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Chapter 8: Spring Reactive and Spring Cloud Stream</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_creating_a_reactive_restful_api_with_spring_webflux">Creating a Reactive RESTful API with Spring WebFlux</a>
<ul class="sectlevel2">
<li><a href="#_steps_to_create_the_api">Steps to Create the API</a></li>
<li><a href="#_understanding_the_implementation">Understanding the Implementation</a></li>
<li><a href="#_additional_information">Additional Information</a></li>
</ul>
</li>
<li><a href="#_using_a_reactive_api_client">Using a Reactive API Client</a>
<ul class="sectlevel2">
<li><a href="#_steps_to_create_a_reactive_consumer_application">Steps to Create a Reactive Consumer Application</a></li>
<li><a href="#_how_it_works">How It Works</a></li>
</ul>
</li>
<li><a href="#_testing_reactive_applications">Testing Reactive Applications</a>
<ul class="sectlevel2">
<li><a href="#_steps_to_create_tests">Steps to Create Tests</a></li>
<li><a href="#_how_it_works_2">How It Works</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="sboot_proven.html">&lt;Contents&gt;</a></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Spring WebFlux Docs</dt>
<dd>
<p><a href="https://docs.spring.io/spring-framework/reference/web/webflux.html" class="bare">https://docs.spring.io/spring-framework/reference/web/webflux.html</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_reactive_restful_api_with_spring_webflux">Creating a Reactive RESTful API with Spring WebFlux</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Reactive is part of the Spring framework that offers features for
reactive programming, allowing us to build asynchronous and non-blocking
applications with Spring Boot. Reactive programming is beneficial for
applications that need to handle high concurrency and scalability, such
as web applications with numerous simultaneous connections or real-time
data processing systems.</p>
</div>
<div class="paragraph">
<p>In this guide, we will create a RESTful API using Spring WebFlux, which
is specifically designed for building reactive web applications.</p>
</div>
<div class="exampleblock">
<div class="content">
<a href="https://github.com/PacktPublishing/Spring-Boot-3.0-Cookbook/tree/main/chapter8/recipe8-1/end" target="_blank">
recipe8-1/end</a>
</div>
</div>
<div class="sect2">
<h3 id="_steps_to_create_the_api">Steps to Create the API</h3>
<div class="paragraph">
<p>Follow these steps to create a RESTful API using reactive programming:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Generate a Spring Boot Project:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Go to <a href="https://start.spring.io">Spring Initializr</a>.</p>
</li>
<li>
<p>Use the same parameters as in <a href="restful.hrml">Chapter 1</a> from the <strong>Creating a RESTful API</strong> recipe, with the following
changes:</p>
<div class="ulist">
<ul>
<li>
<p>Set <strong>Artifact</strong> to <strong>cards</strong>.</p>
</li>
<li>
<p>Under <strong>Dependencies</strong>, select <strong>Spring Reactive Web</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Create a Card Record:</strong></p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>cards</strong> project, create a record named <strong>Card</strong>. Define it as
follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> record Card(<span class="predefined-type">String</span> cardId, <span class="predefined-type">String</span> album, <span class="predefined-type">String</span> player, <span class="type">int</span> ranking) {
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Add a Cards Controller:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Create a controller named <strong>CardsController</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CardsController</span> {</code></pre>
</div>
</div>
</li>
<li>
<p>Within the controller, add a method to retrieve all cards:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>
<span class="directive">public</span> Flux&lt;Card&gt; getCards() {
    <span class="keyword">return</span> Flux.fromIterable(<span class="predefined-type">List</span>.of(
        <span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Ivana Andres</span><span class="delimiter">&quot;</span></span>, <span class="integer">7</span>),
        <span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alexia Putellas</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)));
}</code></pre>
</div>
</div>
</li>
<li>
<p>Add another method to retrieve a specific card:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{cardId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Mono&lt;Card&gt; getCard(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> cardId) {
    <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> Card(cardId, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Superplayer</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In WebFlux, <code>Flux&lt;T&gt;</code> is used to represent a stream of objects, while
<code>Mono&lt;T&gt;</code> represents a single object. In traditional programming,
these would correspond to returning <code>List&lt;T&gt;</code> and <code>T</code>, respectively.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Create a Custom Exception:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Add an exception class named <strong>SampleException</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleException</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> {
    <span class="directive">public</span> SampleException(<span class="predefined-type">String</span> message) {
        <span class="local-variable">super</span>(message);
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Implement Error Handling:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Add two more methods to <strong>CardsController</strong> to demonstrate error
handling:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/exception</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Mono&lt;Card&gt; getException() {
    <span class="keyword">throw</span> <span class="keyword">new</span> SampleException(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is a sample exception</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@ExceptionHandler</span>(SampleException.class)
<span class="directive">public</span> ProblemDetail handleSampleException(SampleException e) {
    ProblemDetail problemDetail = ProblemDetail
        .forStatusAndDetail(HttpStatus.BAD_REQUEST, e.getMessage());
    problemDetail.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Exception</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> problemDetail;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getException</code> method always throws an exception, while
<code>handleSampleException</code> manages exceptions of type <strong>SampleException</strong>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Run the Application:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Open a terminal in the root folder of the <strong>cards</strong> project and execute:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will start the RESTful API server.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Test the API:</strong></p>
<div class="ulist">
<ul>
<li>
<p>You can test the application by sending a request to
<code>http://localhost:8080/cards</code> using <strong>curl</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8080/cards</code></pre>
</div>
</div>
</li>
<li>
<p>To see how error handling works, request
<code>http://localhost:8080/exception</code>. This will return an <strong>HTTP 400</strong>
response.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_the_implementation">Understanding the Implementation</h3>
<div class="paragraph">
<p>In this implementation, we used the same annotations found in Spring Web
to define the controllers, but we returned <strong>Mono</strong> and <strong>Flux</strong> types
instead of traditional objects, indicating that responses will be
generated asynchronously.</p>
</div>
<div class="sect3">
<h4 id="_key_concepts">Key Concepts:</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Non-blocking</strong>: Operations related to I/O (like HTTP requests) avoid
blocking threads, enabling high concurrency without needing a dedicated
thread for each request.</p>
</li>
<li>
<p><strong>Backpressure</strong>: A mechanism ensuring that data is produced only as
quickly as it can be consumed, preventing resource exhaustion.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_information">Additional Information</h3>
<div class="paragraph">
<p>In addition to the annotation-based programming model, WebFlux also
supports a <strong>functional programming</strong> model for defining routes and
handling requests. Here’s how to achieve the same functionality as the
<strong>cards</strong> RESTful API using a functional approach:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p><strong>Create a Cards Handler Class:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CardsHandler</span> {
    <span class="directive">public</span> Flux&lt;Card&gt; getCards() {
        <span class="keyword">return</span> Flux.fromIterable(<span class="predefined-type">List</span>.of(
            <span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Ivana Andres</span><span class="delimiter">&quot;</span></span>, <span class="integer">7</span>),
            <span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alexia Putellas</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)));
    }

    <span class="directive">public</span> Mono&lt;Card&gt; getCard(<span class="predefined-type">String</span> cardId) {
        <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> Card(cardId, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Superplayer</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>));
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Configure the Application with Functional Routing:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CardsRouterConfig</span> {
    <span class="annotation">@Bean</span>
    CardsHandler cardsHandler() {
        <span class="keyword">return</span> <span class="keyword">new</span> CardsHandler();
    }

    <span class="annotation">@Bean</span>
    RouterFunction&lt;ServerResponse&gt; getCards() {
        <span class="keyword">return</span> route(GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>), req -&gt;
            ok().body(cardsHandler().getCards(), Card.class));
    }

    <span class="annotation">@Bean</span>
    RouterFunction&lt;ServerResponse&gt; getCard() {
        <span class="keyword">return</span> route(GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards/{cardId}</span><span class="delimiter">&quot;</span></span>), req -&gt;
            ok().body(cardsHandler().getCard(req.pathVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">cardId</span><span class="delimiter">&quot;</span></span>)), Card.class));
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_choosing_a_programming_model">Choosing a Programming Model</h4>
<div class="paragraph">
<p>While the annotation-based approach resembles traditional non-reactive
programming, the functional programming style can be more expressive,
especially for complex routing scenarios. The functional style is
inherently better for handling high concurrency and non-blocking
scenarios, as it integrates seamlessly with reactive programming.</p>
</div>
<div class="paragraph">
<p>The choice between annotation-based and functional programming is
largely a matter of personal preference.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_reactive_api_client">Using a Reactive API Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a reactive RESTful API client that
consumes another RESTful API in a non-blocking fashion using Spring
WebClient.</p>
</div>
<div class="exampleblock">
<div class="content">
<a href="https://github.com/PacktPublishing/Spring-Boot-3.0-Cookbook/tree/main/chapter8/recipe8-2/end" target="_blank">
chapter8/recipe8-2/end</a>
</div>
</div>
<div class="paragraph">
<p>Make sure to run the target project, as we will be consuming its API.</p>
</div>
<div class="sect2">
<h3 id="_steps_to_create_a_reactive_consumer_application">Steps to Create a Reactive Consumer Application</h3>
<div class="paragraph">
<p>Follow these steps to set up your reactive application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a New Application:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="https://start.spring.io/">Spring Boot Initializr</a> to create a
new application.</p>
</li>
<li>
<p>Use the same options as in the <strong>Creating a RESTful API</strong> recipe from
<strong>Chapter 1</strong>, but modify the following:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Artifact</strong>: <code>consumer</code></p>
</li>
<li>
<p><strong>Dependencies</strong>: Select <strong>Spring Reactive Web</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Configure Application Properties:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Open the <code>application.yml</code> file in the <code>src/main/resources</code>
folder.</p>
</li>
<li>
<p>Update it with the following content to set the server port and the
target football service URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">server</span>:
  <span class="key">port</span>: <span class="string"><span class="content">8090</span></span>
<span class="key">footballservice</span>:
  <span class="key">url</span>: <span class="string"><span class="content">http://localhost:8080</span></span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Create a Record for Card:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Create a new record named <code>Card</code> with the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> record Card(<span class="predefined-type">String</span> cardId, <span class="predefined-type">String</span> album, <span class="predefined-type">String</span> player, <span class="type">int</span> ranking) {}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Create the Consumer Controller:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Create a controller class named <code>ConsumerController</code> with a
<code>WebClient</code> instance:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/consumer</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConsumerController</span> {
    <span class="directive">private</span> <span class="directive">final</span> WebClient webClient;

    <span class="directive">public</span> ConsumerController(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${footballservice.url}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> footballServiceUrl) {
        <span class="local-variable">this</span>.webClient = WebClient.create(footballServiceUrl);
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>This controller will allow us to perform non-blocking requests to the
target API.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Method to Get All Cards:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Add the following method to the <code>ConsumerController</code> to retrieve a
stream of <code>Card</code> instances:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Flux&lt;Card&gt; getCards() {
    <span class="keyword">return</span> webClient.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>)
            .retrieve()
            .bodyToFlux(Card.class);
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Method to Get a Specific Card:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Add this method to retrieve a single <code>Card</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards/{cardId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Mono&lt;Card&gt; getCard(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> cardId) {
    <span class="keyword">return</span> webClient.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards/</span><span class="delimiter">&quot;</span></span> + cardId)
            .retrieve()
            .onStatus(HttpStatus::is4xxClientError, response -&gt; Mono.empty())
            .bodyToMono(Card.class);
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Method to Handle Errors:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Create a method to manage different response codes from the remote
server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/error</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Mono&lt;<span class="predefined-type">String</span>&gt; getFailedRequest() {
    <span class="keyword">return</span> webClient.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/invalidpath</span><span class="delimiter">&quot;</span></span>)
            .exchangeToMono(response -&gt; {
                <span class="keyword">if</span> (response.statusCode().equals(HttpStatus.NOT_FOUND)) {
                    <span class="keyword">return</span> Mono.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server returned 404</span><span class="delimiter">&quot;</span></span>);
                } <span class="keyword">else</span> <span class="keyword">if</span> (response.statusCode().equals(HttpStatus.INTERNAL_SERVER_ERROR)) {
                    <span class="keyword">return</span> Mono.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server returned 500: </span><span class="delimiter">&quot;</span></span> + response.bodyToMono(<span class="predefined-type">String</span>.class));
                } <span class="keyword">else</span> {
                    <span class="keyword">return</span> response.bodyToMono(<span class="predefined-type">String</span>.class);
                }
            });
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Run the Consumer Application:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Open a terminal in the root folder of the <code>consumer</code> project and
execute:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw spring-boot:run</code></pre>
</div>
</div>
</li>
<li>
<p>This will start your application on port <strong>8090</strong>, while the server
application runs on port <strong>8080</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Test the Consumer Application:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Test the endpoints using <code>curl</code> commands in your terminal:</p>
<div class="ulist">
<ul>
<li>
<p>Retrieve all cards:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8090/consumer/cards</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve a specific card with ID 7:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8090/consumer/cards/7</code></pre>
</div>
</div>
</li>
<li>
<p>Test the error handling:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://localhost:8090/consumer/error</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works">How It Works</h3>
<div class="paragraph">
<p>In this guide, we built a consumer application that interacts with a
RESTful API using reactive programming principles. The non-blocking
nature of the WebClient allows the consumer application to handle
multiple requests efficiently without blocking threads, thus improving
concurrency compared to traditional blocking applications.</p>
</div>
<div class="paragraph">
<p>By leveraging reactive technologies, your application can perform better
under load, making it suitable for high-performance use cases.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_reactive_applications">Testing Reactive Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To ensure that our reactive Spring Boot applications are robust and
reliable, we need to automate their testing. Spring Boot provides
excellent support for testing reactive applications, especially when you
include the <strong>Spring Reactive Web</strong> starter.</p>
</div>
<div class="paragraph">
<p>In this guide, we’ll learn how to create tests using the components that
Spring Boot provides by default.</p>
</div>
<div class="exampleblock">
<div class="content">
<a href="https://github.com/PacktPublishing/Spring-Boot-3.0-Cookbook/tree/main/chapter8/recipe8-3/end" target="_blank">
chapter8/recipe8-3/end</a>
</div>
</div>
<div class="sect2">
<h3 id="_steps_to_create_tests">Steps to Create Tests</h3>
<div class="sect3">
<h4 id="_1_verify_dependencies">1. Verify Dependencies</h4>
<div class="paragraph">
<p>Ensure that your <strong>pom.xml</strong> file contains the necessary dependencies for
testing. If you created your application with the Spring Boot Initializr
tool and added the Spring Reactive Web starter, the testing dependencies
should already be included:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.projectreactor<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>reactor-test<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_create_tests_for_the_cards_application">2. Create Tests for the Cards Application</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new test class named <strong>CardsControllerTest</strong> in the
<strong>src/test/java/com/packt/cards</strong> folder. The class should be annotated
with <strong>@WebFluxTest</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebFluxTest</span>(CardsController.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CardsControllerTests</span> {</code></pre>
</div>
</div>
</li>
<li>
<p>Inject a <strong>WebTestClient</strong> field using the <strong>@Autowired</strong> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
WebTestClient webTestClient;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <strong>webTestClient</strong> to emulate calls to the reactive RESTful API.
Create a test method for the <strong>/cards</strong> path that returns a list of type
<strong>Card</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testGetCards() {
    webTestClient.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>)
            .exchange()
            .expectStatus().isOk()
            .expectBodyList(Card.class);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a test for the <strong>/cards/exception</strong> path, which always returns a
404 status code:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> testGetException() {
    webTestClient.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards/exception</span><span class="delimiter">&quot;</span></span>)
            .exchange()
            .expectStatus().isBadRequest()
            .expectBody(ProblemDetail.class);
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_3_create_tests_for_the_consumer_application">3. Create Tests for the Consumer Application</h4>
<div class="paragraph">
<p>Since we want to test the <strong>consumer</strong> application independently of the
<strong>cards</strong> application, we need to mock the <strong>cards</strong> application server
using WireMock.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <strong>pom.xml</strong> file of the <strong>consumer</strong> project and add the
following dependency:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.github.tomakehurst<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>wiremock-standalone<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.0.1<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a new test class named <strong>ConsumerControllerTest</strong>. Annotate the
class with <strong>@SpringBootTest</strong> and set the configuration options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootTest</span>(
    webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT,
    classes = {ConsumerApplication.class, ConsumerController.class, ConsumerControllerTests.Config.class})
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConsumerControllerTests</span> {</code></pre>
</div>
</div>
</li>
<li>
<p>Create a configuration subclass named <strong>Config</strong> to define a
<strong>WireMockServer</strong> bean:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TestConfiguration</span>
<span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> WireMockServer webServer() {
        WireMockServer wireMockServer = <span class="keyword">new</span> WireMockServer(<span class="integer">7979</span>);
        wireMockServer.start();
        <span class="keyword">return</span> wireMockServer;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Set the URI for the mocked server using <strong>@DynamicPropertySource</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DynamicPropertySource</span>
<span class="directive">static</span> <span class="type">void</span> setProperties(DynamicPropertyRegistry registry) {
    registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">footballservice.url</span><span class="delimiter">&quot;</span></span>, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:7979</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Inject <strong>WebTestClient</strong> and <strong>WireMockServer</strong> into the test class:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> WebTestClient webTestClient;
<span class="annotation">@Autowired</span>
<span class="directive">private</span> WireMockServer server;</code></pre>
</div>
</div>
</li>
<li>
<p>Write a test method to retrieve the cards:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> getCards() {
    server.stubFor(WireMock.get(WireMock.urlEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cards</span><span class="delimiter">&quot;</span></span>))
        .willReturn(WireMock.aResponse()
            .withStatus(<span class="integer">200</span>)
            .withHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
            .withBody(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">
            [
                {
                    </span><span class="delimiter">&quot;</span></span>cardId<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span><span class="integer">1</span><span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>album<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span>WWC23<span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>player<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span>Ivana Andres<span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>ranking<span class="string"><span class="delimiter">&quot;</span><span class="content">: 7
                },
                {
                    </span><span class="delimiter">&quot;</span></span>cardId<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span><span class="integer">2</span><span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>album<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span>WWC23<span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>player<span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span>Alexia Putellas<span class="string"><span class="delimiter">&quot;</span><span class="content">,
                    </span><span class="delimiter">&quot;</span></span>ranking<span class="string"><span class="delimiter">&quot;</span><span class="content">: 1
                }
            ]</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)));

    webTestClient.get().uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/consumer/cards</span><span class="delimiter">&quot;</span></span>)
        .exchange().expectStatus().isOk()
        .expectBodyList(Card.class).hasSize(<span class="integer">2</span>)
        .contains(<span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Ivana Andres</span><span class="delimiter">&quot;</span></span>, <span class="integer">7</span>),
                  <span class="keyword">new</span> Card(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">WWC23</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alexia Putellas</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>));
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works_2">How It Works</h3>
<div class="paragraph">
<p>Using the <strong>@WebFluxTest</strong> annotation allows us to focus on testing only
WebFlux-related components, disabling the configuration of all other
components. This includes configuring classes annotated with
<strong>@Controller</strong> or <strong>@RestController</strong> while excluding classes annotated
with <strong>@Service</strong>. This setup enables Spring Boot to inject
<strong>WebTestClient</strong>, which facilitates performing requests to our
application server.</p>
</div>
<div class="paragraph">
<p>In the consumer application, we mocked the <strong>cards</strong> service using a
configuration subclass annotated with <strong>@TestConfiguration</strong>. This allows
us to define beans that can be used in tests. We also dynamically
configured the URI for the mocked server using the
<strong>@DynamicPropertySource</strong> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To reference the <strong>Config</strong> class, we used
<strong>ConsumerControllerTests.Config</strong>. This is necessary because it&#8217;s a
subclass of the <strong>ConsumerControllerTests</strong> class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>webEnvironment</strong> field is set to
<strong>SpringBootTest.WebEnvironment.RANDOM_PORT</strong>, which allows the test to
host the application as a service on a random port to prevent port
collisions with any remote server.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-17 11:13:06 +0200
</div>
</div>
</body>
</html>